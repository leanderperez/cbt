{% load static %}
<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Selección de Fases</title>
    <link rel="stylesheet" href="{% static 'css/style_cards.css' %}"> 
  </head>
    
<body>
  <div class="container">
    <h3>Paso 2: Seleccione las Fases de la Obra</h3>
    <div class="content">
      <form method="post" id="card-selection-form">
        {% csrf_token %}
        {{ wizard.management_form }}
        
        <div class="card-container">
          
          <div class="card-wrapper">
              <input type="checkbox" id="id_fase_Transporte" name="fases_seleccionadas" value="Transporte">
              <label for="id_fase_Transporte">
                  <div class="card" data-card-name="Transporte">
                    <img src="{% static 'img/transporte.png' %}" alt="Card 1 Image">
                    <h2>Transporte</h2>
                    <p>Incluye el transporte e izaje de los equipos de ser contratados por el cliente</p>
                    <br><br>
                    <div class="accents"><div class="top-light"></div></div>
                  </div>
              </label>
          </div>
          
          <div class="card-wrapper">
              <input type="checkbox" id="id_fase_Electricidad_y_Control" name="fases_seleccionadas" value="Electricidad y Control">
              <label for="id_fase_Electricidad_y_Control">
                  <div class="card" data-card-name="Electricidad y Control">
                    <img src="{% static 'img/electricidad.png' %}" alt="Card 2 Image">
                    <h2>Electricidad y Control</h2>
                    <p>Incluye la conexión eléctrica, la instalacion de protecciones y control</p>
                    <br>
                    <div class="accents"><div class="top-light"></div></div>
                  </div>
              </label>
          </div>
          
          <div class="card-wrapper">
              <input type="checkbox" id="id_fase_Mecanica" name="fases_seleccionadas" value="Mecánica">
              <label for="id_fase_Mecanica">
                  <div class="card" data-card-name="Mecánica">
                    <img src="{% static 'img/midea1.png' %}" alt="Card 3 Image">
                    <h2>Mecánica</h2>
                    <p>Comprende toda la instalación mecánica de los equipos</p>
                    <br><br><br>
                    <div class="accents"><div class="top-light"></div></div>
                  </div>
              </label>
          </div>

          <div class="card-wrapper">
              <input type="checkbox" id="id_fase_Ventilacion" name="fases_seleccionadas" value="Ventilación">
              <label for="id_fase_Ventilacion">
                  <div class="card" data-card-name="Ventilación">
                    <img src="{% static 'img/ventilacion.png' %}" alt="Card 4 Image">
                    <h2>Ventilación</h2>
                    <p>instalación de ductos de ventilación y extracción según requerimientos del cliente.</p>
                    <br>
                    <div class="accents"><div class="top-light"></div></div>
                  </div>
              </label>
          </div>
          
          <div class="card-wrapper">
              <input type="checkbox" id="id_fase_Puesta_en_marcha" name="fases_seleccionadas" value="Puesta en marcha">
              <label for="id_fase_Puesta_en_marcha">
                  <div class="card" data-card-name="Puesta en marcha">
                    <img src="{% static 'img/entrega.png' %}" alt="Card 5 Image">
                    <h2>Puesta en marcha</h2>
                    <p>Arranque y monitoreo de parámetros de operación de los equipos</p>
                    <br><br>
                    <div class="accents"><div class="top-light"></div></div>
                  </div>
              </label>
          </div>
          
        </div>
        
        <div class="button">
          <button type="submit" name="wizard_goto_step" value="{{ wizard.steps.prev }}">Anterior</button>
          <button type="submit" id="submit-button">Crear Obra</button>
        </div>
      </form>
    </div>
  </div>
  
<script>
document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('card-selection-form');

    // Listener principal para el envío del formulario (SOLO para validación)
    form.addEventListener('submit', (e) => {
        // Lógica de validación
        const isPrevButton = e.submitter && e.submitter.name === 'wizard_goto_step';
        
        if (!isPrevButton) {
             // Contamos los checkboxes que están marcados
             const selectedCount = document.querySelectorAll('input[name="fases_seleccionadas"]:checked').length;
             
             if (selectedCount === 0) {
                 alert('Por favor, seleccione al menos una fase para la obra.');
                 e.preventDefault(); // Detiene el envío si no hay fases
             }
        }
    });
});
</script>
</body>
</html>